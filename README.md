**MPD**

Проект представляет собой websocket API для взаимодействия с mpd-сервером.
Имеется фронтовая часть на react+typescript.

Проект состоит из двух модулей: mpd-back и mpd-front/

Описание пакетов в бэк-модуле:
 - ru.net.arh.mpd:
   - aop - аспекты
   - cache - кэш
   - config - spring-конфигурация
   - connection - внутренний API взаимодействия с с mpd-сервером
   - events - сервисы обрабатывающие события (connect, disconnect, idle-события). 
   Результатом является отправка событий с обновленной информацией. Так же происходит очистка кэшей по необходимости.
   - model - модельные сущности
   - services - набор сервисов, содержащих логику взаимодействия м/ду клиентским API и внутренним АPI (connection)
   - stomp - содержит сервис учета подписчиков. Служит для того, чтобы при отсутствии "подписчиков" на события web-socket, при наступлении событий, не происходил запрос информации.
   Является необязательным, служит для снижения нагрузки.
   - util - содержит утильный класс по парсингу "сырых" ответов mpd-сервера в объекты/коллекции объектов
   - validation - валидация
   - web - контроллеры, хендлеры
   
Описание кастомных аннотаций:
  - @MpdAnswer - служит для парсинга ответов.
  - @ThrowIfNotConnected - вешается на методы сервисов. В случае если метод вызван, когда отсутствует соединение с mpd, сразу бросает исключение.
  - @MapKeys - вешается на параметры типа Map. Валидация мапы на предмет наличия в ней указанных в аннотации ключей.
  - @MpdIldeEventClass/@MpdIldeEventMethod - вешается на классы/методы сервисов. Помечает метод для вызова при наступлении соотвествующего события. 
  При наличии над этим методом аннотации @Cacheable, так же предварительно очищает указанные в ней кэши.
  - MpdErrorType - помечает методы контроллера. При получении Exception в ответ пользователю подставляется <тип запроса>_FAILED из этой аннотации.

**WebSocket API:**

Запрос:
```json
{
    <REQUEST>
}
```

Ответы об ошибках:

```json
{ 
    type: <TYPE1>_FAILED, 
    msg: <текст ошибки>
}
```

Success ответ:
```json
{
    type: <TYPE2>,
    payload: <RESPONSE>
}
```

 - Запрос состояния соединения:

| topic | REQUEST | TYPE1 | TYPE2 | RESPONSE |
|---|---|---|---|---|
| /mpd/connectionState | `{}` | CONNECTION_STATE | CONNECTION_STATE | true |

 - Изменение состояния соединения:

| topic | REQUEST | TYPE1 | TYPE2 | RESPONSE |
|---|---|---|---|---|
| /mpd/connectionState | true |  | CHANGE_CONNECTION_STATE |  |

 - Запрос устройств вывода звука:
 
 | topic | REQUEST | TYPE1 | TYPE2 | RESPONSE |
 |---|---|---|---|---|
 | /mpd/connectionState | `{}` | OUTPUT | OUTPUT | `{ [ {id: 1, name: 'my output', enabled: true }, {id: 2, name: 'my output2', enabled: true } ] }` |

 - Включение/отключение устройства вывода звука:
 
 | topic | REQUEST | TYPE1 | TYPE2 | RESPONSE |
 |---|---|---|---|---|
 | /output/change | `{id: 1, name: 'my output', enabled: true }` |  | OUTPUT |  |

 - Плейер. Начать воспроизведение трека по id / позиции в плейлисте / позиции в плейлисте с перемоткой на время

 | topic | REQUEST | TYPE1 | TYPE2 | RESPONSE |
 |---|---|---|---|---|
 | /player/playid | `12` |  | PLAYER |  |
 | /player/playpos | `14` |  | PLAYER |  |
 | /player/seek | `{songPos: 12, seekPos: 123}` |  | PLAYER |  |
 
 - Плейер. Управление.
 
 | topic | REQUEST | TYPE1 | TYPE2 | RESPONSE |
 |---|---|---|---|---|
 | /player/playid | `{cmd: 'PLAY'}` |  | PLAYER |  |
 
 - Плейлист
 
//todo

 - Статус.
 
 - Сохраненные плейлисты
 
 - Стриминг аудио
 
 - Дерево музыкальной коллекции
 
 Сервис обновления информации о текущем времени воспроизведения.
 Отправляет уведомления по шедулеру (2-а раза в секунду). Отправка осуществляется, только если установлен коннект и воспроизведение в режиме "play"
 Отправляет уведомления в топик `/topic/songTime` Формат сообщения:
 
 ```javascript
{
    songPos: 12,
    playing: true,
    songTime: {
      current: 200,
      full: 350
    }
}
```